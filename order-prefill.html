<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order Prefill + Payment Modal — Games Planet</title>
  <style>
    :root{--accent:#0b6ef6;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; padding:18px; background:#f6f8fb; color:#111;}
    .card{max-width:900px;margin:18px auto;background:#fff;border-radius:10px;padding:18px;box-shadow:0 6px 20px rgba(20,20,40,.06)}
    h1{font-size:20px;margin:0 0 8px}
    label{display:block;font-size:13px;margin:8px 0 6px;color:var(--muted)}
    input[type="text"], input[type="tel"], input[type="email"], select, input[type="number"] {width:100%;padding:10px;border:1px solid #e6e9ef;border-radius:8px;font-size:15px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .product {display:flex;gap:12px;align-items:center;margin:10px 0}
    .product img{width:88px;height:88px;object-fit:cover;border-radius:8px;border:1px solid #eee}
    .small{font-size:13px;color:var(--muted)}
    .summary{background:#fbfcff;padding:10px;border-radius:8px;margin-top:12px}
    .totals{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee}
    .totals.final{font-weight:700;font-size:18px;border-bottom:0;padding-top:10px}
    .btn{display:inline-block;background:var(--accent);color:#fff;padding:12px 14px;border-radius:8px;text-decoration:none;border:0;cursor:pointer;width:100%;font-size:16px}
    .secondary{background:#fff;border:1px solid #e6e9ef;color:#111}
    .muted{color:var(--muted)}
    .flex-between{display:flex;justify-content:space-between;align-items:center}
    @media (max-width:600px){ .row{flex-direction:column} .product img{width:72px;height:72px} }

    /* Modal styles */
    .modal-backdrop{position:fixed;inset:0;background:rgba(10,10,20,0.45);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{width:100%;max-width:820px;background:#fff;border-radius:12px;padding:16px;box-shadow:0 10px 40px rgba(10,10,30,0.25);position:relative}
    .modal .close {position:absolute;right:12px;top:8px;font-size:22px;border:0;background:transparent;cursor:pointer}
    .modal h3{margin:6px 0 10px}
    .payment-grid{display:grid;grid-template-columns:1fr 320px;gap:12px;align-items:start}
    .qr{width:280px;height:280px;border:1px solid #eee;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#fafafa;padding:8px}
    .qr img{max-width:100%;height:auto}
    .small-note{font-size:12px;color:var(--muted);margin-top:6px}
    .pay-row{display:flex;gap:8px;margin-top:12px}
    .chip{display:inline-block;padding:6px 8px;border-radius:8px;border:1px solid #e6e9ef;background:#fff;font-size:13px}
    .two-qr {display:flex;gap:12px;align-items:center;justify-content:center}
    .upi-info {margin-top:8px;font-weight:600}
  </style>
</head>
<body>
  <div class="card" id="app">
    <h1>Order Prefill — Games Planet</h1>
    <p class="small">Fill details aur <strong>Pay Now</strong> dabaye — payment popup khulega jisme Paytm QR by default aur Razorpay links dono available rahenge.</p>

    <!-- Product block -->
    <div class="product" aria-live="polite">
      <img id="product-img" src="" alt="Product image" onerror="this.style.display='none'">
      <div>
        <div id="product-name" style="font-weight:600">Product Name</div>
        <div id="product-variant" class="small">Variant</div>
        <div id="product-price" style="margin-top:8px;font-weight:700">₹0</div>
      </div>
    </div>

    <!-- Form -->
    <form id="orderForm" onsubmit="return handlePlaceOrder(event)">
      <label>Quantity</label>
      <input type="number" id="qty" min="1" value="1" />

      <label>पूरा नाम (Full name) *</label>
      <input type="text" id="buyer-name" placeholder="Ex: Rajinder Singh" required />

      <div class="row">
        <div class="col">
          <label>मोबाइल नंबर (Mobile) *</label>
          <input type="tel" id="buyer-phone" placeholder="10 digit number" required />
        </div>
        <div class="col">
          <label>ईमेल (Optional)</label>
          <input type="email" id="buyer-email" placeholder="example@mail.com" />
        </div>
      </div>

      <label>डिलीवरी पता *</label>
      <input type="text" id="buyer-address" placeholder="House, Street, City, PIN" required />

      <label>किसी नोट/रिमार्क (Optional)</label>
      <input type="text" id="order-note" placeholder="Extra info (example: preferred delivery time)" />

      <div style="margin-top:12px">
        <label>Shipping Charge (₹)</label>
        <input type="number" id="shipping" value="150" min="0" />
      </div>

      <div class="summary" aria-hidden="false">
        <div class="totals"><div>Subtotal</div><div id="subtotal">₹0</div></div>
        <div class="totals"><div>Shipping</div><div id="show-shipping">₹0</div></div>
        <div class="totals"><div>GST (if selected)</div><div id="show-gst">₹0</div></div>
        <div class="totals"><div>Card surcharge (2.50% if selected)</div><div id="show-surge">₹0</div></div>
        <div class="totals final"><div>Total payable</div><div id="total-amt">₹0</div></div>
      </div>

      <div style="margin-top:12px" class="flex-between">
        <button type="button" class="btn secondary" onclick="resetForm()">Reset</button>
        <button type="button" class="btn" id="openPaymentBtn">Pay Now</button>
      </div>
    </form>

    <p class="small" style="margin-top:10px">By placing order you accept seller terms (prepaid only · 1 month warranty · no COD).</p>
  </div>

  <!-- Modal / Popup -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <button class="close" id="modalCloseBtn" aria-label="Close">&times;</button>
      <h3>Payment — Confirm & Pay</h3>

      <div class="payment-grid">
        <div>
          <div><strong id="modalProductTitle">PS4 Console</strong></div>
          <div class="small-note" id="modalProductDesc">Variant / details</div>

          <hr style="margin:10px 0 12px"/>

          <label><input type="checkbox" id="gstCheckbox"> GST billing required (18%)</label>
          <div class="small-note">Default: Non GST (unchecked). Invoice ke liye check karein.</div>

          <label style="margin-top:8px"><input type="checkbox" id="cardCheckbox"> Card payment choos karein (2.50% extra)</label>
          <div class="small-note">Card surcharge total pe add hoke dikhai dega.</div>

          <div class="summary" style="margin-top:12px">
            <div class="totals"><div>Subtotal</div><div id="m-subtotal">₹0</div></div>
            <div class="totals"><div>Shipping</div><div id="m-shipping">₹0</div></div>
            <div class="totals"><div>GST (18%)</div><div id="m-gst">₹0</div></div>
            <div class="totals"><div>Card surcharge (2.50%)</div><div id="m-surge">₹0</div></div>
            <div class="totals final"><div>Amount to pay</div><div id="m-total">₹0</div></div>
          </div>

          <div class="pay-row" style="margin-top:12px">
            <button class="btn" id="modalPayBtn">Open Razorpay Link</button>
            <button class="btn secondary" id="copyAmountBtn" style="width:140px">Copy ₹</button>
          </div>

          <div class="small-note" style="margin-top:8px">
            Note: Pay button opens Razorpay short-link. For exact forced amount you should create a Razorpay order server-side. Paytm QR supports amount prefill via UPI deep-link shown on QR.
          </div>

          <div style="margin-top:10px" class="upi-info">
            <div>UPI Paytm: <strong>Surender Kaur</strong></div>
            <div>UPI ID: <strong id="paytmUpi">paytmqr5hyx5o@ptys</strong></div>
            <div class="small-note">Mobile: <strong>7983624797</strong></div>
          </div>
        </div>

        <div>
          <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-bottom:8px">
            <div class="chip" id="selectedMethodChip">Method: Paytm QR</div>
          </div>

          <div style="display:flex;flex-direction:column;gap:12px">
            <div class="two-qr">
              <!-- Paytm QR (left) -->
              <div class="qr" id="paytmQrWrap">
                <img id="paytmQrImage" src="" alt="Paytm QR (scan to pay)"/>
              </div>

              <!-- Razorpay QR (right) -->
              <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
                <div class="qr" id="rzpQrWrap">
                  <img id="rzpQrImage" src="" alt="Razorpay QR / shortlink QR"/>
                </div>

                <label for="productRzpSelect">Product / Razorpay link</label>
                <select id="productRzpSelect" style="padding:10px;border-radius:8px;border:1px solid #e6e9ef">
                  <option value="">-- choose product (optional) --</option>
                  <option value="https://rzp.io/rzp/PgyV9mRw">PS4 Pro Imported — 1TB</option>
                  <option value="https://rzp.io/rzp/0E33jyEW">PS4 Slim Imported Japanese White — 1TB</option>
                  <option value="https://rzp.io/rzp/jXtphLQL">PS4 Slim Imported Japanese — 500GB</option>
                  <option value="https://rzp.io/rzp/EHqUJrR8">PS4 Slim Imported Japanese — 1TB (Black)</option>
                  <option value="https://rzp.io/rzp/2piebaE">PS4 Pro Imported Japanese — 2TB</option>
                </select>

                <a id="openLinkDirect" class="btn" style="text-align:center;width:220px" target="_blank" rel="noopener">Open selected Razorpay link</a>
              </div>
            </div>

            <div class="small-note">Scan Paytm QR ya Razorpay QR/Link dono se payment possible hai. Copy button se amount copy karke bhi UPI app me paste kar sakte hain.</div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Config: Paytm UPI details you provided ---
    const PAYTM_UPI_ID = 'paytmqr5hyx5o@ptys';
    const PAYTM_PAYEE_NAME = 'SURENDER KAUR';
    const PAYTM_PHONE = '7983624797';

    // --- Query params / initial populate (same as before) ---
    function qp(name, fallback='') {
      const params = new URLSearchParams(window.location.search);
      return params.get(name) || fallback;
    }
    function fmt(n){ return '₹' + Number(n).toLocaleString('en-IN', {maximumFractionDigits:0}) }
    const productName = decodeURIComponent(qp('name','PS4 Console'));
    const productVariant = decodeURIComponent(qp('variant','Default'));
    const unitPrice = Number(qp('price', '0')) || 0;
    const productImg = qp('img','');
    const sellerPhone = qp('phone', PAYTM_PHONE);

    document.getElementById('product-name').textContent = productName;
    document.getElementById('product-variant').textContent = productVariant;
    document.getElementById('product-price').textContent = fmt(unitPrice);
    document.getElementById('modalProductTitle').textContent = productName + ' — ' + productVariant;
    document.getElementById('modalProductDesc').textContent = 'Unit: ' + fmt(unitPrice);
    if(productImg) document.getElementById('product-img').src = productImg;
    document.getElementById('paytmUpi').textContent = PAYTM_UPI_ID;

    // form elements
    const qtyInput = document.getElementById('qty');
    const shippingInput = document.getElementById('shipping');
    const subtotalEl = document.getElementById('subtotal');
    const showShippingEl = document.getElementById('show-shipping');
    const showGstEl = document.getElementById('show-gst');
    const showSurgeEl = document.getElementById('show-surge');
    const totalAmtEl = document.getElementById('total-amt');

    function recalcAll() {
      const qty = Math.max(1, Number(qtyInput.value)||1);
      const shipping = Math.max(0, Number(shippingInput.value)||0);
      const subtotal = unitPrice * qty;
      subtotalEl.textContent = fmt(subtotal);
      showShippingEl.textContent = fmt(shipping);
      showGstEl.textContent = fmt(0);
      showSurgeEl.textContent = fmt(0);
      totalAmtEl.textContent = fmt(subtotal + shipping);
      updateModalValues();
      return {qty, subtotal, shipping};
    }
    [qtyInput, shippingInput].forEach(el => el.addEventListener('input', recalcAll));
    recalcAll();

    // --- Modal logic ---
    const modalBackdrop = document.getElementById('modalBackdrop');
    const openPaymentBtn = document.getElementById('openPaymentBtn');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const gstCheckbox = document.getElementById('gstCheckbox');
    const cardCheckbox = document.getElementById('cardCheckbox');
    const mSubtotalEl = document.getElementById('m-subtotal');
    const mShippingEl = document.getElementById('m-shipping');
    const mGstEl = document.getElementById('m-gst');
    const mSurgeEl = document.getElementById('m-surge');
    const mTotalEl = document.getElementById('m-total');
    const productRzpSelect = document.getElementById('productRzpSelect');
    const paytmQrImage = document.getElementById('paytmQrImage');
    const rzpQrImage = document.getElementById('rzpQrImage');
    const openLinkDirect = document.getElementById('openLinkDirect');
    const modalPayBtn = document.getElementById('modalPayBtn');
    const selectedMethodChip = document.getElementById('selectedMethodChip');
    const copyAmountBtn = document.getElementById('copyAmountBtn');

    function openModal(){
      recalcAll(); // ensure base numbers up to date
      productRzpSelect.value = '';
      setQrForRzp(''); // clear rzp
      updateModalValues();
      modalBackdrop.style.display = 'flex';
      modalBackdrop.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modalBackdrop.style.display = 'none';
      modalBackdrop.setAttribute('aria-hidden','true');
    }
    openPaymentBtn.addEventListener('click', openModal);
    modalCloseBtn.addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', function(e){
      if(e.target === modalBackdrop) closeModal();
    });

    function updateModalValues(){
      const qty = Math.max(1, Number(qtyInput.value)||1);
      const shipping = Math.max(0, Number(shippingInput.value)||0);
      const subtotal = unitPrice * qty;
      const gstOn = gstCheckbox.checked;
      const cardOn = cardCheckbox.checked;
      const gstAmt = gstOn ? Math.round((subtotal + shipping) * 18 / 100) : 0;
      const baseForSurcharge = subtotal + shipping + gstAmt;
      const surgeAmt = cardOn ? Math.round(baseForSurcharge * 2.5 / 100) : 0;
      const total = subtotal + shipping + gstAmt + surgeAmt;

      mSubtotalEl.textContent = fmt(subtotal);
      mShippingEl.textContent = fmt(shipping);
      mGstEl.textContent = fmt(gstAmt);
      mSurgeEl.textContent = fmt(surgeAmt);
      mTotalEl.textContent = fmt(total);

      showGstEl.textContent = fmt(gstAmt);
      showSurgeEl.textContent = fmt(surgeAmt);
      totalAmtEl.textContent = fmt(total);

      // Paytm QR: update to include amount if total > 0
      setQrForPaytm(total);

      // update pay button label
      modalPayBtn.textContent = productRzpSelect.value ? ('Pay ₹' + Number(total).toLocaleString('en-IN')) : 'Open Razorpay Link';
      selectedMethodChip.textContent = productRzpSelect.value ? (cardOn ? 'Method: Razorpay (Card)' : 'Method: Razorpay/Short-link') : (cardOn ? 'Method: Card' : 'Method: Paytm QR');
    }

    // wire checkbox events to recalc
    [gstCheckbox, cardCheckbox].forEach(el => el.addEventListener('change', updateModalValues));
    [qtyInput, shippingInput].forEach(el => el.addEventListener('input', updateModalValues));

    // Build Paytm UPI deep-link and QR
    // UPI link format (suggested): upi://pay?pa=<upi id>&pn=<payee name>&tn=<note>&am=<amount>&cu=INR
    function buildUpiLink(amountRupees){
      // amountRupees is number (rounded)
      const pa = encodeURIComponent(PAYTM_UPI_ID);
      const pn = encodeURIComponent(PAYTM_PAYEE_NAME);
      const tn = encodeURIComponent(productName + ' - ' + productVariant);
      const cu = 'INR';
      if(amountRupees && Number(amountRupees) > 0){
        // include amount as decimal with two places
        const am = encodeURIComponent((Number(amountRupees)).toFixed(2));
        return `upi://pay?pa=${pa}&pn=${pn}&tn=${tn}&am=${am}&cu=${cu}`;
      } else {
        return `upi://pay?pa=${pa}&pn=${pn}&tn=${tn}&cu=${cu}`;
      }
    }

    function setQrForPaytm(totalAmountNumber){
      // Prefer: use Google Chart API to render QR for UPI deep link
      const upiLink = buildUpiLink(totalAmountNumber);
      const enc = encodeURIComponent(upiLink);
      // 280x280 QR
      const qrSrc = 'https://chart.googleapis.com/chart?chs=280x280&cht=qr&chl=' + enc;
      paytmQrImage.src = qrSrc;
      paytmQrImage.alt = 'Paytm UPI QR — ' + PAYTM_UPI_ID;
    }

    // Razorpay short-link QR
    function setQrForRzp(link) {
      if(!link){ rzpQrImage.src=''; openLinkDirect.href='#'; openLinkDirect.textContent='Open selected Razorpay link'; return; }
      const enc = encodeURIComponent(link);
      const qrSrc = 'https://chart.googleapis.com/chart?chs=240x240&cht=qr&chl=' + enc;
      rzpQrImage.src = qrSrc;
      openLinkDirect.href = link;
      openLinkDirect.textContent = 'Open selected Razorpay link';
    }
    productRzpSelect.addEventListener('change', function(){
      setQrForRzp(this.value);
      updateModalValues();
    });

    // Modal pay button behavior:
    modalPayBtn.addEventListener('click', function(){
      const link = productRzpSelect.value;
      const totalText = mTotalEl.textContent.replace('₹','').replace(/,/g,'').trim();
      if(link){
        // open selected Razorpay short-link
        window.open(link, '_blank', 'noopener');
      } else {
        // no rzp selected -> show instruction to use Paytm QR or copy amount
        alert('Koi Razorpay link select nahi hua. Aap Paytm QR scan karke ya "Copy ₹" se amount copy kar ke UPI app me payment kar sakte hain.');
      }
    });

    // quick copy amount to clipboard
    copyAmountBtn.addEventListener('click', function(){
      const amtText = mTotalEl.textContent.replace('₹','').replace(/,/g,'').trim();
      navigator.clipboard?.writeText(amtText).then(()=> {
        copyAmountBtn.textContent = 'Copied';
        setTimeout(()=> copyAmountBtn.textContent = 'Copy ₹',1200);
      }).catch(()=> {
        alert('Unable to copy. Amount: ' + mTotalEl.textContent);
      });
    });

    // open direct link button (also opens in new tab)
    openLinkDirect.addEventListener('click', function(e){
      if(!this.href || this.href.endsWith('#')) { e.preventDefault(); alert('Kripya product ke Razorpay link ko select karein. (Right dropdown)'); }
    });

    // Reset form
    function resetForm(){
      document.getElementById('orderForm').reset();
      document.getElementById('qty').value = 1;
      document.getElementById('shipping').value = 150;
      gstCheckbox.checked = false;
      cardCheckbox.checked = false;
      recalcAll();
    }

    // Basic form submit -> open modal (we prevented real submit)
    function handlePlaceOrder(e){
      e.preventDefault();
      const name = document.getElementById('buyer-name').value.trim();
      const phone = document.getElementById('buyer-phone').value.trim();
      const address = document.getElementById('buyer-address').value.trim();
      if(!name || !phone || !address){
        alert('कृपया नाम, मोबाइल और पता भरें।');
        return false;
      }
      document.getElementById('modalProductTitle').textContent = productName + ' — ' + productVariant;
      openModal();
      return false;
    }

    // close on esc
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape') closeModal();
    });

    // initial
    updateModalValues();

  </script>
</body>
</html>
